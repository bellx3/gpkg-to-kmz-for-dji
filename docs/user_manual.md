# SkyMission Builder 상세 매뉴얼 (User Manual)

본 문서는 **SkyMission Builder**를 사용하여 GPKG 데이터를 기반으로 DJI 드론용 미션 파일을 생성하고 관리하는 상세 방법을 설명합니다.

---

## 1. 사전 준비 (System Requirements)

본 프로그램은 Python 3.10 이상의 환경에서 작동하며, 공간 데이터 처리를 위해 다음 라이브러리가 필요합니다.

### 필수 라이브러리 설치
터미널(또는 CMD)에서 아래 명령어를 입력하여 필요한 라이브러리를 설치하세요.
```bash
pip install shapely geopandas fiona pyproj pyogrio
```

---

## 2. 화면 구성 가이드

프로그램은 조작 편의를 위해 **2단 레이아웃**으로 구성되어 있습니다.

### 좌측 섹션: 비행 및 데이터 경로
- **데이터 설정**: GPKG/KML 파일이 담긴 폴더를 지정합니다. '자동 포맷' 기능을 통해 파일 형식을 스스로 결정합니다.
- **파일명 필드**: 생성될 KMZ 파일의 이름을 결정할 속성 컬럼을 선택합니다. (예: 지번, ID 등)
- **드론 모델**: 사용하는 기종을 선택하세요. 모델에 따라 통신 프로토콜과 카메라 설정이 자동 최적화됩니다.
- **지형 팔로우**: 최신 기종(M3E, M350 등) 사용 시 실시간 지형 추적 기능을 활성화할 수 있습니다.

### 우측 섹션: 상세 파라미터 (Mission Specs)
- **임무 고도 (m)**: 실제 기체가 비행하며 사진을 촬영하거나 스캔할 높이입니다.
- **중첩도 (%)**: 
    - **진행방향(종)**: 드론이 전진하며 촬영하는 사진 간의 겹침 정도.
    - **옆경로(횡)**: 비행 경로 간의 옆면 겹침 정도.
- **짐벌 피치 (°)**: 카메라의 렌즈 각도입니다. 수직 촬영 시 -90도를 유지합니다.
- **단순화 오차 (m)**: 지오메트리가 너무 복잡할 경우 컨트롤러 부하를 줄이기 위해 폴리곤을 단순화합니다. (기본 0.0m 권장)

---

## 3. 표준 작업 워크플로우 (Step-by-Step)

### Step 1: 소스 데이터 준비
준비된 `.gpkg` 파일을 프로젝트의 `input/` 폴더에 복사합니다.

### Step 2: 프로그램 실행 및 설정
`main.py`를 실행한 후, **"프리셋 불러오기"** 버튼을 눌러 `presets/` 폴더에 저장된 표준 설정값을 로드합니다. 이는 수동 입력을 최소화해 줍니다.

### Step 3: 속성 필드 매핑
**"필드 새로고침 ↻"** 버튼을 누릅니다. 파일명 필드 드롭다운 메뉴에서 각 미션의 파일 이름으로 사용할 컬럼(예: `ADDRE_1_2`)을 선택합니다.

### Step 4: 미션 생성
**"미션 생성 실행"** 버튼을 클릭합니다. 하단 로그 창에 진행 상황이 출력되며, 완료 메시지가 뜨면 작업이 종료됩니다.

### Step 5: 결과 확인 및 전송
`output/` 폴더에 생성된 `.kmz` 파일들을 드론 앱(DJI Pilot 2)으로 복사하여 비행을 시작합니다.

---

## 4. 주요 파라미터 상세 설명

| 항목 | 권장값 | 설명 |
| :--- | :--- | :--- |
| 이륙 안전 고도 | 20 ~ 30m | 기체가 이륙 후 미션 지점으로 이동하기 전 상승할 안전 높이입니다. |
| 전환 속도 | 10 ~ 15m/s | 미션 구역 간 또는 이동 시의 최대 속도입니다. |
| 마진 (Margin) | 0m | 작업 구역 외곽으로 얼마나 더 넓게 비행할지 결정합니다. |
| 짐벌 피치 | -90.0° | 정사영상 촬영 시 필수 설정값입니다. |

---

## 5. 자주 묻는 질문 (FAQ)

**Q: "bad option -fill" 오류가 납니다.**
A: 최신 버전으로 업데이트하세요. 레이아웃 재구성 과정에서 발생한 버그로, 현재는 `sticky` 옵션으로 모두 수정되었습니다.

**Q: 특정 필드가 드롭다운에 나오지 않습니다.**
A: GPKG 파일의 레이어 정보가 일치하지 않을 수 있습니다. `input/` 폴더 내에 해당 파일이 있는지, 그리고 유효한 공간 데이터인지 QGIS 등에서 확인해 보세요.

**Q: 지형 팔로우 체크박스가 비활성(Grey-out) 상태입니다.**
A: 선택하신 드론 모델이 해당 기능을 지원하지 않는 레거시 모델(P4R 등)인 경우 안전을 위해 앱에서 자동으로 차단한 기능입니다.

---

## 6. 개발 및 유지보수

본 프로그램의 소스 코드는 매듈화되어 있어 확장이 용이합니다.
- 새로운 드론 추가: `src/core/enums.py` 수정
- 변환 로직 변경: `src/core/generator.py` 수정
- UI 개선: `src/gui/app.py` 수정

---
*Last Updated: 2026-02-11*
