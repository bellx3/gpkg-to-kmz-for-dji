# SkyMission Builder 고도화 계획서 (Phase 3)

## 1. 개요
현재의 GPKG 기반 대량 미션 생성 로직을 바탕으로, DJI 기체별 하드웨어 특성을 반영하고 현장 설정을 "Zero"에 가깝게 만드는 정밀 미션 생성기로 업그레이드합니다.

## 2. 주요 개발 목표

### 2.1 하드웨어 인텔리전스 (dji_enums.py 연동)
- **기체 모델 선택**: UI에서 사용자가 드론 모델(Mavic 3E, M350 등)을 선택 가능하도록 구현.
- **Payload 매칭**: 선택된 기체에 맞는 카메라/라이다 Enum 값을 WPML에 자동 주입.
- **기기별 특성 반영**: 서브 Enum 및 페이로드 위치 인덱스 자동 설정.

### 2.2 비행 디테일 설정 (Field Expansion)
- **카메라 틸트 제어**: 짐벌 피치 각도(Gimbal Pitch) 설정 기능 추가.
- **지형 추적 모드**: `surfaceRelativeHeight` 및 지형 추적 활성화 여부 제어.
- **고급 비행 옵션**: 이륙 안전 고도, 전환 속도 등을 프리셋에 완전 통합.

### 2.3 UI/UX 및 워크플로우 개선
- **프리셋 강화**: 기체 정보가 포함된 확장된 JSON 프리셋 포맷 도입.
- **에러 핸들링**: 기체 파라미터 유도 값(예: 고도 대비 속도)에 대한 유효성 검사 경고 추가.

## 3. 세부 작업 리스트

- [/] **Task 1: Backend (kml_setting_v2.py) 수정**
    - `dji_enums.py` 데이터 임포트 및 XML 주입 로직 구현. (완료)
    - 짐벌 피치 및 지형 추적 XML 노드 업데이트 기능 추가. (완료)
- [/] **Task 2: UI (ui_desktop.py) 레이아웃 개선**
    - 드론 모델 선택용 콤보박스(Combobox) 추가. (완료)
    - 짐벌 각도 및 지형 추적 설정용 위젯 배치. (완료)
- [ ] **Task 3: 프리셋 포맷 마이그레이션**
    - 기존 프리셋에 드론 모델 정보를 포함하도록 구조 변경.
- [ ] **Task 4: 통합 테스트 및 검증**
    - 주요 기체별(M3E, M350) 생성 KMZ 파일 구조 검증.

## 4. 기대 효과
- 현장 조종기에서 기체 정보를 다시 인식시키거나 짐벌 각도를 조절하는 시간을 완전히 제거.
- 비행 중 발생할 수 있는 데이터 일관성 문제 해결 및 미션 신뢰도 향상.
